{% extends "base.html" %}
<body>
{% block content %}
    <div>
        <input type="hidden" name="database_id" value="{{ database.id }}">
        <input type="hidden" name="table_id" value="{{ table.id }}">
        <h1>Insert Row into {{ table.name }}</h1>
        <form id="insert-row-form" method="POST" action="/tables/{{ database.id }}/{{ table.id }}/insert">
        {% if error_message %}
            <div style="color: red; font-weight: bold; margin-bottom: 10px;">
                {{ error_message }}
            </div>
        {% endif %}

    <div id="row-form-groups">
        {% if columns %}
            {% for column in columns %}
                <div class="row-form-group">
                    <label for="column-{{ column.id }}">Column {{ column.name }}:</label>
                    {% set required_attr = 'required' if not column.is_nullable else '' %}
                    {% set required_attr_name = 'Not Nullable' if not column.is_nullable else 'Nullable' %}
                    {% if column.data_type == 'INTEGER' or column.data_type == 'FLOAT' %}
                        <input type="number" id="column-{{ column.id }}" name="column-{{ column.id }}[]" step="any" {{ required_attr }}>
                    {% elif column.data_type == 'BOOLEAN' %}
                        <select id="column-{{ column.id }}" name="column-{{ column.id }}[]" {{ required_attr }}>
                            <option value="true">True</option>
                            <option value="false">False</option>
                        </select>
                    {% elif column.data_type == 'DATE' %}
                        <input type="date" id="column-{{ column.id }}" name="column-{{ column.id }}[]" {{ required_attr }}>
                    {% elif column.data_type == 'VARCHAR' or column.data_type == 'TEXT' %}
                        <input type="text" id="column-{{ column.id }}" name="column-{{ column.id }}[]" {{ required_attr }}>
                    {% else %}
                        <input type="text" id="column-{{ column.id }}" name="column-{{ column.id }}[]" {{ required_attr }}>
                    {% endif %}
                    <span>{{ required_attr_name }}</span>
                </div>
            {% endfor %}
        {% else %}
            <p>No columns available to insert data.</p>
        {% endif %}
    </div>

    <!-- Buttons for adding new row and submitting form -->
    <div id="button-group" style="margin-top: 20px;">
        <button type="button" class="btn btn-secondary" id="add-row-button">Insert Another Row</button>
        <button type="submit" class="btn btn-success">Submit Rows</button>
    </div>
</form>
    </div>

    <script>
        document.getElementById('add-row-button').addEventListener('click', function() {
    // Clone the first row-form-group
    var originalFormGroup = document.querySelector('.row-form-group');
    var newFormGroup = originalFormGroup.cloneNode(true);

    // Reset input values in the cloned form
    var inputs = newFormGroup.querySelectorAll('input, select');
    inputs.forEach(function(input) {
        if (input.type === 'select-one') {
            input.selectedIndex = 0; // Reset select to the first option
        } else {
            input.value = ''; // Clear input value
        }
    });

    // Append the new row form group to the form, before the button group
    document.getElementById('row-form-groups').appendChild(newFormGroup);

    // Add event listener for the new remove button
    newFormGroup.querySelector('.remove-row-button').addEventListener('click', function() {
        newFormGroup.remove(); // Remove the row form group
    });
});

// Attach event listener to the initial remove button
document.querySelector('.remove-row-button').addEventListener('click', function() {
    this.closest('.row-form-group').remove(); // Remove the row form group
});

    </script>
{% endblock %}
</body>
</html>